/*
 * jQuery Nivo Slider v3.0
 * http://nivo.dev7studios.com
 *
 * Copyright 2010, Gilbert Pellegrom
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * June 2010 by valZho
 *		options value case insensitivity, order insensitivity (using regex)
 *		completely rewritten animation algorithm supports:
 *		-- slice animation styles: right(default), left, in, out, mix (per controller)
 *		-- ability to set specific animation slice order (per controller)
 *		-- set animation slice delay time (per controller)
 *		-- support for ease (per controller)
 *		-- background fade out with custom timing (per controller)
 * May 2010 - Pick random effect from specified set of effects by toronegro
 * May 2010 - controlNavThumbsFromRel option added by nerd-sh
 * May 2010 - Do not start nivoRun timer if there is only 1 slide by msielski
 * April 2010 - controlNavThumbs option added by Jamie Thompson (http://jamiethompson.co.uk)
 * March 2010 - manualAdvance option added by HelloPablo (http://hellopablo.co.uk)
 */
(function($){$.fn.nivoSlider=function(A){var B=$.extend({},$.fn.nivoSlider.defaults,A);var C='';if(A.effect!==undefined){B.autoEffect=A.effect;B.prevEffect=A.effect;B.nextEffect=A.effect;B.controlEffect=A.effect}if(A.animSpeed!==undefined){B.autoSpeed=A.animSpeed;B.prevSpeed=A.animSpeed;B.nextSpeed=A.animSpeed;B.controlSpeed=A.animSpeed}if(A.outSpeed!==undefined){B.autoOut=A.outSpeed;B.prevOut=A.outSpeed;B.nextOut=A.outSpeed;B.controlOut=A.outSpeed}if(A.ease!==undefined){B.autoEase=A.ease;B.prevEase=A.ease;B.nextEase=A.ease;B.controlEase=A.ease}if(A.buffer!==undefined){B.autoBuffer=A.buffer;B.prevBuffer=A.buffer;B.nextBuffer=A.buffer;B.controlBuffer=A.buffer}if(A.order!==undefined){B.autoOrder=A.order;B.prevOrder=A.order;B.nextOrder=A.order;B.controlOrder=A.order}return this.each(function(){var e={prevSlide:0,currentSlide:0,currentImage:'',totalSlides:0,running:false,paused:false,stop:false};var f=$(this);f.data('nivo:vars',e);f.css('position','relative');f.addClass('nivoSlider');var g=f.children();g.each(function(){var a=$(this);var b='';if(!a.is('img')){if(a.is('a')){a.addClass('nivo-imageLink');b=a}a=a.find('img:first')}var c=a.width();if(c==0)c=a.attr('width');var d=a.height();if(d==0)d=a.attr('height');if(c>f.width()){f.width(c)}if(d>f.height()){f.height(d)}if(b!=''){b.css('display','none')}a.css('display','none');e.totalSlides++});if(B.startSlide>0){if(B.startSlide>=e.totalSlides)B.startSlide=e.totalSlides-1;e.currentSlide=B.startSlide;e.prevSlide=e.currentSlide}$(g[e.currentSlide]).css({display:'block',opacity:'1.0'});if($(g[e.currentSlide]).is('img')){e.currentImage=$(g[e.currentSlide])}else{$(g[e.currentSlide]).find('img:first').css({display:'block',opacity:'1.0'});e.currentImage=$(g[e.currentSlide]).find('img:first')}for(var i=0;i<B.slices;i++){var h=Math.round(f.width()/B.slices);if(i==B.slices-1){f.append($('<div class="nivo-slice"></div>').css({left:(h*i)+'px',width:(f.width()-(h*i))+'px',display:'none'}))}else{f.append($('<div class="nivo-slice"></div>').css({left:(h*i)+'px',width:h+'px',display:'none'}))}if(B.autoOrder.length<i+1)B.autoOrder[i]=i;if(B.prevOrder.length<i+1)B.prevOrder[i]=i;if(B.nextOrder.length<i+1)B.nextOrder[i]=i;if(B.controlOrder.length<i+1)B.controlOrder[i]=i}f.append($('<div class="nivo-caption"><p></p></div>').css({display:'none',opacity:B.captionOpacity}));if(e.currentImage.attr('title')!=''){$('.nivo-caption p',f).html(e.currentImage.attr('title'));$('.nivo-caption',f).fadeIn(B.animSpeed)}if(!B.manualAdvance&&g.length>1){C=setInterval(function(){nivoRun(f,g,B,false)},B.pauseTime)}function goToSlide(a,b){if(e.running||e.currentSlide==a)return false;e.currentSlide=a-1;nivoRun(f,g,B,b)};if(B.directionNav){f.append('<div class="nivo-directionNav"><a class="nivo-prevNav">Prev</a><a class="nivo-nextNav">Next</a></div>');if(B.directionNavHide){$('.nivo-directionNav',f).hide();f.hover(function(){$('.nivo-directionNav',f).show()},function(){$('.nivo-directionNav',f).hide()})}$('a.nivo-prevNav',f).live('click',function(){goToSlide(e.currentSlide-1,'prev')});$('a.nivo-nextNav',f).live('click',function(){goToSlide(e.currentSlide+1,'next')})};if(B.keyboardNav){$(window).keypress(function(a){if(a.keyCode=='37'){goToSlide(e.currentSlide-1,'prev')}if(a.keyCode=='39'){goToSlide(e.currentSlide+1,'next')}})};if(B.controlNav){var j=$('<div class="nivo-controlNav"></div>');f.append(j);for(var i=0;i<g.length;i++){if(B.controlNavThumbs){var k=g.eq(i);if(!k.is('img')){k=k.find('img:first')}if(B.controlNavThumbsFromRel){j.append('<a class="nivo-control" rel="'+i+'"><img src="'+k.attr('rel')+'" alt="" /></a>')}else{j.append('<a class="nivo-control" rel="'+i+'"><img src="'+k.attr('src').replace(B.controlNavThumbsSearch,B.controlNavThumbsReplace)+'" alt="" /></a>')}}else{j.append('<a class="nivo-control" rel="'+i+'">'+i+'</a>')}}$('.nivo-controlNav a:eq('+e.currentSlide+')',f).addClass('active');$('.nivo-controlNav a',f).live('click',function(){goToSlide($(this).attr('rel'),'control')})};if(B.pauseOnHover){f.hover(function(){e.paused=true;clearInterval(C);C=''},function(){e.paused=false;if(C==''&&!e.running&&!B.manualAdvance){C=setInterval(function(){nivoRun(f,g,B,false)},B.pauseTime)}})};f.bind('nivo:animFinished',function(){$(g).each(function(){$(this).css('display','none')});$(g[e.currentSlide]).css({display:'block',opacity:'1.0'});if($(g[e.currentSlide]).is('a')){$(g[e.currentSlide]).find('img:first').css({display:'block',opacity:'1.0'})};$('.nivo-slice',f).css({display:'none',background:''});e.running=false;e.prevSlide=e.currentSlide;if(C==''&&!e.paused&&!B.manualAdvance){C=setInterval(function(){nivoRun(f,g,B,false)},B.pauseTime)};B.afterChange.call(this)})});function nivoRun(e,f,g,h){var j=e.data('nivo:vars');if(j.running||((!j||j.stop)&&!h))return false;clearInterval(C);C='';var k=g.autoEffect;var l=g.autoSpeed;var m=g.autoOut;var o=g.autoEase;var p=g.autoBuffer;var q=g.autoOrder.slice(0);switch(h){case'prev':k=g.prevEffect;l=g.prevSpeed;m=g.prevOut;o=g.prevEase;p=g.prevBuffer;q=g.prevOrder.slice(0);break;case'next':k=g.nextEffect;l=g.nextSpeed;m=g.nextOut;o=g.nextEase;p=g.nextBuffer;q=g.nextOrder.slice(0);break;case'control':k=g.controlEffect;l=g.controlSpeed;m=g.controlOut;o=g.controlEase;p=g.controlBuffer;q=g.controlOrder.slice(0);break};g.beforeChange.call(this);$(f).each(function(){var a=$(this);a.css({display:'none',opacity:'0'});if(a.is('a')){a.find('img:first').css({display:'none',opacity:'0'})}});if(m==='none'){e.css('background','url('+j.currentImage.attr('src')+') no-repeat')}else{e.css('background','');$(f[j.prevSlide]).css({display:'block',opacity:'1.0'});if($(f[j.prevSlide]).is('a')){$(f[j.prevSlide]).find('img:first').css({display:'block',opacity:'1.0'})}};j.currentSlide++;if(j.currentSlide==j.totalSlides){j.currentSlide=0;g.slideshowEnd.call(this)}else if(j.currentSlide<0){j.currentSlide=(j.totalSlides-1)};if($(f[j.currentSlide]).is('img')){j.currentImage=$(f[j.currentSlide])}else{j.currentImage=$(f[j.currentSlide]).find('img:first')};if(g.controlNav){$('.nivo-controlNav a',e).removeClass('active');$('.nivo-controlNav a:eq('+j.currentSlide+')',e).addClass('active')};if(j.currentImage.attr('title')!=''){if($('.nivo-caption',e).css('display')=='block'){$('.nivo-caption p',e).fadeOut(l,function(){$(this).html(j.currentImage.attr('title'));$(this).fadeIn(l)})}else{$('.nivo-caption p',e).html(j.currentImage.attr('title'))};$('.nivo-caption',e).fadeIn(l)}else{$('.nivo-caption',e).fadeOut(l)};var i=0;$('.nivo-slice',e).each(function(){var a=Math.round(e.width()/g.slices);$(this).css({height:'0',opacity:'0',background:'url('+j.currentImage.attr('src')+') no-repeat -'+((a+(i*a))-a)+'px 0%'});i++});if(k=='random'){var r=new Array('down','downLeft','downIn','downOut','downMix','up','upLeft','upIn','upOut','upMix','upDown','upDownLeft','upDownIn','upDownOut','upDownMix','fold','foldLeft','foldIn','foldOut','foldMix','fade');k=r[Math.floor(Math.random()*(r.length+1))];if(k==undefined)k='fade'};if(k.indexOf(',')!=-1){var r=k.split(',');k=$.trim(r[Math.floor(Math.random()*r.length)]);if(k==undefined)k='fade'};j.running=true;var s=$('.nivo-slice',e);var t='fade';var u=0;var c=0;var v='0';var w='';var x={style:{opacity:'1.0'},speed:l,ease:o};if(k.match(/updown/i)){t='updown';$.extend(x.style,{height:'100%'});var y=0}else if(k.match(/down/i)){t='down';$.extend(x.style,{height:'100%'})}else if(k.match(/up/i)){t='up';$.extend(x.style,{height:'100%'});v='';w='0'}else if(k.match(/fold/i)){t='fold'}else if(k.match(/fade/i)){t='fade';x.speed=l*2;p=0};if(k.match(/left/i)){q.reverse()}else if(k.match(/mix/i)){q.sort(function(){return(Math.round(Math.random())-0.5)})}else if(k.match(/in/i)){var z=[];for(i=0,n=1;i<g.slices;i++){z[i]=n;if((i+1)<(g.slices/2)){n++}else if((i+1)>(g.slices/2)){n--}}q=z}else if(k.match(/out/i)){var z=[];for(i=0,n=Math.ceil(g.slices/2);i<g.slices;i++){z[i]=n;if((i+1)<(g.slices/2)){n--}else if((i+1)>(g.slices/2)){n++}};q=z}s.each(function(){var a=$(this);var b=0;var d={};if(t=='updown'){if(y){v='0';w='';y=0}else{v='';w='0';y=1}}switch(t){case'updown':case'down':case'up':a.css({bottom:w,top:v});break;case'fold':d={width:a.width()};a.css({height:'100%',width:'0'});break;case'fade':a.css({height:'100%',display:'block'});break}b=p*q[c];u=u<q[c]?q[c]:u;setTimeout(function(){a.animate($.extend(x.style,d),x.speed,x.ease)},b);c++});u=l+(p*u);if(m!=='none'){if(m==='match')m=u;if(m<0)m=0;if($(f[j.prevSlide]).is('img')){$(f[j.prevSlide]).animate({opacity:'0'},m,o)}else{$(f[j.prevSlide]).find('img:first').animate({opacity:'0'},m,o)}}else{j.backFlag=true};if(u<m)u=m;setTimeout(function(){e.trigger('nivo:animFinished')},u)}};$.fn.nivoSlider.defaults={autoEffect:'random',prevEffect:'random',nextEffect:'random',controlEffect:'random',autoSpeed:500,prevSpeed:500,nextSpeed:500,controlSpeed:500,autoOut:'none',prevOut:'none',nextOut:'none',controlOut:'none',autoEase:'linear',prevEase:'linear',nextEase:'linear',controlEase:'linear',autoBuffer:50,prevBuffer:50,nextBuffer:50,controlBuffer:50,autoOrder:[],prevOrder:[],nextOrder:[],controlOrder:[],slices:15,pauseTime:3000,startSlide:0,directionNav:true,directionNavHide:true,controlNav:true,controlNavThumbs:false,controlNavThumbsFromRel:false,controlNavThumbsSearch:'.jpg',controlNavThumbsReplace:'_thumb.jpg',keyboardNav:true,pauseOnHover:true,manualAdvance:false,captionOpacity:0.8,beforeChange:function(){},afterChange:function(){},slideshowEnd:function(){}}})(jQuery);